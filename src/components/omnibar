---
import Settings from "@components/Settings.astro"
import { Icon } from 'astro-icon/components';
---
<nav class="sticky bg-base p-2 flex items-center space-x-2">
  <h1 class="mr-auto">bromine</h1>

  <div class="flex items-center justify-center flex-1 space-x-2">
    <button
      aria-label="Back"
      id="omnibar-back-btn"
      class="shadow-md bg-surface p-1.5 rounded-md hover:bg-gray-600"
    >
      <Icon name="lucide:arrow-left" class="size-4.5" />
    </button>

    <button
      aria-label="Forward"
      id="omnibar-forward-btn"
      class="shadow-md bg-surface p-1.5 rounded-md hover:bg-gray-600"
    >
      <Icon name="lucide:arrow-right" class="size-4.5" />
    </button>

    <button
      aria-label="Reload"  
      id="omnibar-reload-btn"
      class="shadow-md bg-surface p-1.5 rounded-md hover:bg-gray-600"
    >
      <Icon name="lucide:refresh-cw" class="size-4.5" />
    </button>

    <div class="shadow-md dark:bg-surface flex items-center rounded-md px-3 py-1.5">
      <Icon name="lucide:search" class="size-4.5 mr-2" />
      <form id="form" class="flex-center w-md"> 
        <input
          spellcheck="false"
          autofocus
          autocomplete="off"
          id="address"
          type="text"
          placeholder="Search the web freely"
          class="bg-transparent w-full focus:outline-none"
        />
      </form>
    </div>

    <button
      aria-label="Settings"
      id="omnibar-settings-btn"
      class="shadow-md bg-surface p-1.5 rounded-md hover:bg-gray-600"
    >
      <Icon name="lucide:settings" class="size-4.5"/>
    </button>
  </div>
  </nav>

<Settings/>

<script is:inline defer>
  const backButton = document.getElementById('omnibar-back-btn');
  const forwardButton = document.getElementById('omnibar-forward-btn');
  const reloadButton = document.getElementById('omnibar-reload-btn');
  const settingsButton = document.getElementById('omnibar-settings-btn');
  const popup = document.getElementById('settings-popup');
  const popupContent = document.getElementById('settings-popup-content');
  
  backButton.addEventListener('click', () => {
    const iframe = document.getElementById('frame');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.history.back();
    }
  });

  forwardButton.addEventListener('click', () => {
    const iframe = document.getElementById('frame');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.history.forward();
    }
  });

  reloadButton.addEventListener('click', () => {
    const iframe = document.getElementById('frame');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.location.reload();
    }
  });

    // --- Ping Function (Client-Side) ---
    async function updatePing(url) {
      const pingResultEl = document.getElementById('ping-result');
      if (!pingResultEl) return;
      pingResultEl.textContent = 'Pinging...';
      const startTime = performance.now();
      try {
        await fetch(url, { mode: 'no-cors', cache: 'no-store' });
        const endTime = performance.now();
        const duration = Math.round(endTime - startTime);
        pingResultEl.textContent = `${duration}ms`;
      } catch (e) {
        pingResultEl.textContent = 'Error';
      }
    }

    function openPopup() {
      popup.classList.remove('invisible', 'pointer-events-none');
    popup.classList.add('opacity-100');
      popupContent.classList.add('translate-y-0');

      updatePing("https://bromineproxy.netlify.app/");
    }



settingsButton?.addEventListener('click', openPopup);
</script>
