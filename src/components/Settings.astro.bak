---
import { Icon } from 'astro-icon/components';
---
<div id="settings-popup" class="fixed inset-0 flex items-center justify-center bg-base/80 backdrop-blur-sm hidden z-[10000]">
  <div class="bg-surface w-[90vw] max-w-[500px] rounded-lg shadow-xl p-6 m-4 max-h-[80vh] overflow-y-auto transform translate-y-[-50px] opacity-0 transition-all duration-300 ease-in-out">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-semibold text-text">Settings</h1>
      <button
        id="close-settings-btn"
        aria-label="Close settings"
        class="text-text hover:text-iris transition-colors"
      >
        <Icon name="lucide:x" class="size-6" />
      </button>
    </div>
    
    <div class="space-y-4">
      <section class="space-y-2">
        <h2 class="text-lg font-medium text-text">Proxy</h2>
        <div class="flex items-center justify-between">
          <label class="text-text">Default Search Engine</label>
          <select id="search-engine" class="bg-base text-text rounded-md p-1">
            <option value="https://search.brave.com/search?q=%s">Brave</option>
            <option value="https://google.com/search?q=%s">Google</option>
            <option value="https://www.bing.com/search?q=%s">Bing</option>
            <option value="https://duckduckgo.com/?q=%s&ia=web">DuckDuckGo</option>
            <option value="https://search.yahoo.com/search?p=%s">Yahoo</option>
            <option value="https://searx.si/search?q=%s">SearXNG</option>
            <option value="https://www.qwant.com/?q=%s">Qwant</option>
          </select>
        </div>
        <div class="flex items-center justify-between">
          <label class="text-text">Proxy Transport</label>
          <select id="proxy-transport" class="bg-base text-text rounded-md p-1">
            <option value="libcurl">Libcurl(better for firefox)</option>
            <option value="epoxy">Epoxy(better for chrome)</option>
            <option value="bare">Bare(deprecated)</option>
          </select>
        </div>

      </section>

      <section class="space-y-2">
        <h2 class="text-lg font-medium text-text">Privacy</h2>
        <div class="flex items-center justify-between">
          <label class="text-text">Block Trackers</label>
          <input type="checkbox" id="block-trackers" class="toggle bg-overlay checked:light:bg-pine" />
        </div>
      </section>
    </div>
  </div>
</div>

<script is:inline defer>
  const closeButton = document.getElementById('close-settings-btn');
  const popup = document.getElementById('settings-popup');
  const searchEngineSelect = document.getElementById('search-engine');
  const transportToggle = document.getElementById("proxy-transport");
  const blockTrackersToggle = document.getElementById('block-trackers');

  // Load settings from localStorage
  function loadSettings() {
    const settings = {
      searchEngine: localStorage.getItem('searchEngine') || 'https://search.brave.com/search?q=%s',
      blockTrackers: localStorage.getItem('blockTrackers') === 'true',
      transport: localStorage.getItem("transport") || "libcurl", 
    };

    transportToggle.value = settings.transport;
    searchEngineSelect.value = settings.searchEngine;
    blockTrackersToggle.checked = settings.blockTrackers;
  }

  // Save settings to localStorage
  function saveSettings() {
    localStorage.setItem('searchEngine', searchEngineSelect.value);
    localStorage.setItem("transport", transportToggle.value);
    localStorage.setItem('blockTrackers', blockTrackersToggle.checked);
    location.reload();
  }

  // Initialize settings
  loadSettings();

  // Add event listeners for settings changes
  searchEngineSelect.addEventListener('change', saveSettings);
  transportToggle.addEventListener("change", saveSettings);
  blockTrackersToggle.addEventListener('change', saveSettings);

  // Close popup
  closeButton?.addEventListener('click', () => {
    if (!popup.classList.contains('hidden')) {
      popup.classList.add('hidden');
    }
  });
</script>


<style>
  /* Popup animation */
  #settings-popup:not(.hidden) .transform {
    transform: translateY(0);
    opacity: 1;
  }

  /* Toggle switch styles */
  .toggle {
    appearance: none;
    width: 40px;
    height: 20px;
    border-radius: 9999px;
    position: relative;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .toggle::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    background-color: white;
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: transform 0.2s;
  }

  .toggle:checked::after {
    transform: translateX(20px);
  }

  /* Scrollbar styles */
  .overflow-y-auto::-webkit-scrollbar {
    width: 8px;
  }

  .overflow-y-auto::-webkit-scrollbar-track {
    background: transparent;
  }

  .overflow-y-auto::-webkit-scrollbar-thumb {
    background: #6B7280;
    border-radius: 4px;
  }

  .overflow-y-auto::-webkit-scrollbar-thumb:hover {
    background: #9CA3AF;
  }
</style>

